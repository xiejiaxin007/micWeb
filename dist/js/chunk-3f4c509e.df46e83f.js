(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3f4c509e"],{"0db9":function(e,t,o){"use strict";o.r(t);var l=o("3526"),r=o.n(l);for(var a in l)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return l[e]}))}(a);t.default=r.a},"13d5":function(e,t,o){"use strict";var l=o("23e7"),r=o("d58f").left,a=o("a640"),i=o("ae40"),s=o("2d00"),n=o("605d"),f=a("reduce"),p=i("reduce",{1:0});l({target:"Array",proto:!0,forced:!f||!p||!n&&s>79&&s<83},{reduce:function(e){return r(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},1500:function(e,t,o){(t=o("24fb")(!1)).push([e.i,".img-list-box[data-v-26973d6c]{margin-top:16px}.img-list-box .img-box[data-v-26973d6c]{border:1px solid #ccc}.img-list-box .img-box>img[data-v-26973d6c]{width:60px;height:60px;-o-object-fit:contain;object-fit:contain}.img-list-box .btn-del[data-v-26973d6c]{text-align:center}.img-list-box .btn-del>span[data-v-26973d6c]{color:#409eff;line-height:32px}.img-list-box .img-item[data-v-26973d6c]{display:inline-block;margin-right:16px}.img-list-box .img-item[data-v-26973d6c]:last-of-type{margin-right:0}.img-list-box .img-item .file-name[data-v-26973d6c]{color:#00f;text-decoration:underline}.img-list-box .img-item .btn-del[data-v-26973d6c]{margin-left:10px;color:#409eff;cursor:pointer}.file-box-wrapper[data-v-26973d6c]{line-height:24px}.img-box-wrapper[data-v-26973d6c]{margin-top:10px}.edit-follow-up-box .content-box[data-v-26973d6c]{background:#fff;padding:0 30px 30px}.edit-follow-up-box .bread-crumb-box[data-v-26973d6c]{padding:0 30px}.group-table-box h2[data-v-26973d6c]{line-height:60px}.group-table-box h2 .group-id[data-v-26973d6c]{font-size:14px;padding-left:40px}.group-table-box .header-box[data-v-26973d6c] .tips{float:right}.group-table-box .header-box[data-v-26973d6c] .tips .el-form-item__content{font-size:12px}.follow-up-box[data-v-26973d6c]{margin-top:24px}.follow-up-box .el-form-item[data-v-26973d6c]{margin-right:30px}.follow-up-box .form-item-children[data-v-26973d6c]{margin-left:490px}.follow-up-box[data-v-26973d6c] .left-right-layout{margin-bottom:30px}.follow-up-box[data-v-26973d6c] .left-right-layout .el-form{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:left;-ms-flex-pack:left;justify-content:left}.follow-up-box[data-v-26973d6c] .left-right-layout .step-left{width:490px}.follow-up-box[data-v-26973d6c] .left-right-layout .step-left .el-radio-group .el-radio{display:block;line-height:40px}.follow-up-box[data-v-26973d6c] .left-right-layout .step-right .el-form-item{margin:0}.follow-up-box[data-v-26973d6c] .left-right-layout .step-right .form-item-box{height:40px}.follow-up-box[data-v-26973d6c] .left-right-layout .step-right .img-form-item-box{margin-top:20px;height:auto}.file-show-box .file-list .preview-file[data-v-26973d6c]{color:#00f;text-decoration:underline;margin:0 10px}.file-show-box .img-list[data-v-26973d6c]{margin-top:16px}.file-show-box .img-list li[data-v-26973d6c]{float:left;width:100px;height:130px;text-align:center;margin-right:12px}.file-show-box .img-list li .img-item-box[data-v-26973d6c]{width:100%;height:100px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border:1px solid #eee}.file-show-box .img-list li .img-item-box img[data-v-26973d6c]{max-width:100%;max-height:100%}[data-v-26973d6c] .input-text-box .el-form-item__content{width:500px}.upload-btn[data-v-26973d6c]{display:inline-block;margin-right:20px}.upload-tips[data-v-26973d6c]{color:#888}.tips[data-v-26973d6c]{color:#fc0d1b}",""]),e.exports=t},"1d6c":function(e,t,o){var l=o("8379");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);(0,o("499e").default)("e023b2ac",l,!0,{sourceMap:!1,shadowMode:!1})},3526:function(e,t,o){"use strict";var l=o("4ea4");o("4160"),o("a15b"),o("13d5"),o("a434"),o("a9e3"),o("b680"),o("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o("96cf");var r=l(o("1da1")),a=l(o("405c")),i=o("7223"),s={name:"follow-up-list",props:{typeList:{type:String,default:""},id:{type:String,default:""},pageType:{type:String,default:""},currentStage:{type:String,default:""}},data:function(){return{loading:"",tableList:[],moveList:[],prePaidTotal:"",unfollowedTotal:"",followedTotal:"",followMoneyTotalFlag:!0}},created:function(){this.getFollowedForecastList()},methods:{followUpFun:function(e,t){t.follow_money-t.unfollowed_money>0&&(this.$message("本次跟进金额不能大于单笔剩余回款金额"),this.tableList[e].follow_money=t.unfollowed_money);var o=this.tableList.reduce((function(e,t){return e+Number(t.follow_money)}),0);this.followedTotal=parseFloat(o).toFixed(2),this.followedTotal-this.unfollowedTotal>0?(this.$message("本次跟进金额合计不能大于"+this.unfollowedTotal),this.followMoneyTotalFlag=!1):this.followMoneyTotalFlag=!0},getSummaries:function(e){var t=this,o=e.columns,l=[];return o.forEach((function(e,o){0!==o?("pre_paid_money"===e.property&&(l[o]=t.prePaidTotal),"unfollowed_money"===e.property&&(l[o]=t.unfollowedTotal),"follow_money"===e.property&&(l[o]=t.followedTotal)):l[o]="合计"})),l},getFollowedForecastList:function(){var e=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"2"!==e.pageType){t.next=7;break}return t.next=4,a.default.getForecastList({follow_id:e.id});case 4:o=t.sent,t.next=11;break;case 7:return l={type:e.typeList,id:e.id},t.next=10,a.default.followedForecastList(l);case 10:o=t.sent;case 11:0===(r=o.data).code&&(e.tableList=r.data.list,e.prePaidTotal=r.data.pre_paid_total,e.unfollowedTotal=r.data.unfollowed_total,e.followedTotal=r.data.followed_total),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},turnToNewPage:function(e){window.open(e).opener=null},moveOut:function(e,t){this.moveList.push(t),this.tableList.splice(e,1),this.computedSum()},computedSum:function(){for(var e=i.commonFun.deepClone(this.tableList),t=0;t<e.length;t++)for(var o=t+1;o<e.length;o++)e[t].unique_id===e[o].unique_id&&(e.splice(o,1),o--);var l=0,r=0;e.forEach((function(e){l+=Number(e.pre_paid_money),r+=Number(e.unfollowed_money)}));var a=this.tableList.reduce((function(e,t){return e+Number(t.follow_money)}),0);this.followedTotal=parseFloat(a).toFixed(2),this.prePaidTotal=l,this.unfollowedTotal=r},getRemoveList:function(){return this.moveList?this.moveList.join(","):""},getMoneyList:function(){var e=[];return this.tableList.forEach((function(t){e.push({id:t.id,value:t.follow_money})})),e},getMoneyDetailList:function(){var e=[];return this.tableList.forEach((function(t){var o=Object.assign({},t);o.value=o.follow_money,e.push(o)})),{list:e,pre_paid_total:this.prePaidTotal,unfollowed_total:this.unfollowedTotal,followed_total:this.followedTotal}},getFollowMoneyTotalFlag:function(){return this.followMoneyTotalFlag},tableHeaderColor:function(e){e.row,e.column;var t=e.rowIndex;e.columnIndex;if(0===t)return"background-color: #f9f9f9;color: #333;"}}};t.default=s},"3eff":function(e,t,o){"use strict";o.d(t,"a",(function(){return l})),o.d(t,"b",(function(){return r}));var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"edit-follow-up-box"},[o("div",{staticClass:"el-row"},[o("el-col",{staticClass:"content-main",attrs:{span:24}},[o("el-breadcrumb",{staticClass:"bread-crumb-box",attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",[o("a",{attrs:{href:"/"}},[e._v("首页")])]),o("el-breadcrumb-item",[e._v("回款流程跟进")])],1),o("div",{staticClass:"content-box"},[o("div",{staticClass:"group-table-box"},[o("div",{staticClass:"hd"},[o("h2",[e._v("当前阶段："+e._s(e.currentStageName)+" "),o("span",{staticClass:"group-id"},[e._v("回款组ID："+e._s(e.groupId))])])]),o("div",{staticClass:"bd"},[o("el-form",{ref:"followTimeForm",staticClass:"header-box",attrs:{model:e.followTimeForm,"label-width":"124px",inline:!0}},[o("el-form-item",{attrs:{label:"实际跟进时间：",prop:"actualTime",rules:[{required:!0,message:"请选择实际跟进时间",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followTimeForm.actualTime,callback:function(t){e.$set(e.followTimeForm,"actualTime",t)},expression:"followTimeForm.actualTime"}})],1),o("el-form-item",{attrs:{label:"预计回款时间：",prop:"estimateTime",rules:[{required:!0,message:"请选择预计回款时间",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followTimeForm.estimateTime,callback:function(t){e.$set(e.followTimeForm,"estimateTime",t)},expression:"followTimeForm.estimateTime"}})],1),o("el-form-item",{attrs:{label:"创建人："}},[e._v(" "+e._s(e.userInfoObj.text)+" ")]),o("el-form-item",{staticClass:"tips"},[e._v(" 移除的成交单将在提交本次跟进后，自动生成一份同当前阶段的回款组 ")])],1),o("follow-up-list",{ref:"followUpList",attrs:{typeList:"2",id:e.groupId,pageType:"1",currentStage:e.currentStage}}),e.followUpForm.length>0?o("div",{staticClass:"follow-up-box"},[o("el-form",{ref:"followUpOtherForm",attrs:{model:e.followUpOtherForm,inline:!0}},["1"===e.currentStage?o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm0",attrs:{model:e.followUpForm[0],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单业绩是否确认："}},[o("el-radio-group",{model:{value:e.followUpForm[0].follow_result,callback:function(t){e.$set(e.followUpForm[0],"follow_result",t)},expression:"followUpForm[0].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("是")]),o("el-radio",{attrs:{label:"2"}},[e._v("否")])],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[0].follow_result?o("el-form-item",{attrs:{label:"业绩确认完成日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[0].business_datetime,callback:function(t){e.$set(e.followUpForm[0],"business_datetime",t)},expression:"followUpForm[0].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["2"===e.followUpForm[0].follow_result?o("el-form-item",{attrs:{label:"预计业绩确认完成日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[0].business_datetime,callback:function(t){e.$set(e.followUpForm[0],"business_datetime",t)},expression:"followUpForm[0].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[0].follow_result?o("el-form-item",{attrs:{label:"业绩确认完成的凭证（上传的凭证）：",prop:"file_type",rules:[{required:!0,message:"请选择凭证类型",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[0].file_type,callback:function(t){e.$set(e.followUpForm[0],"file_type",t)},expression:"followUpForm[0].file_type"}},[o("el-radio",{attrs:{label:"1"}},[e._v("标准：业绩确认单")]),o("el-radio",{attrs:{label:"2"}},[e._v("非标准：微信聊天记录等")])],1)],1):e._e()],1),"1"===e.followUpForm[0].follow_result?o("div",{staticClass:"form-item-box img-form-item-box"},[o("el-form-item",{attrs:{label:"业绩确认单：",prop:"imgList",rules:[{required:!0,validator:e.checkImg,message:"",trigger:["blur","change"]}]}},[o("div",{staticClass:"upload-btn-box"},[e.imgLimit?o("jl-file-upload",{ref:"confirmFileUpload",staticClass:"upload-btn",attrs:{fileType:"jpg,png,jpeg,gif,pdf",fileMaxSize:"10mb",upID:"confirmImgUpload",isMulti:!0,limit:e.imgLimit,ossData:e.ossData},on:{beforeUpdate:e.beforeUpdate,getFileURL:function(t){return e.getFileURLMethod(t,e.followUpForm[0].imgList)}}},[o("el-button",{attrs:{type:"primary"}},[e._v("上传业绩确认单")])],1):e._e(),o("span",{staticClass:"upload-tips"},[e._v("可上传图片、pdf，上传不超过10个文件，每个附件不超过10M")])],1),e.imgListLenFlag?o("div",{staticClass:"img-list-box"},[e._l(e.followUpForm[0].imgList.file,(function(t,l){return o("div",{key:t.file_path_full,staticClass:"file-box-wrapper"},[o("a",{staticClass:"img-item",attrs:{href:e.OSSView+t.file_path_full,target:"_blank",rel:"noopener noreferrer"}},[o("span",{staticClass:"file-name"},[e._v(e._s(t.file_name))]),o("span",{staticClass:"btn-del",on:{click:function(t){return t.preventDefault(),e.delImg(e.followUpForm[0].imgList.file,l)}}},[e._v("删除")])])])})),o("div",{class:{"img-box-wrapper":e.followUpForm[0].imgList.file.length>0}},e._l(e.followUpForm[0].imgList.img,(function(t,l){return o("a",{key:t.file_path_full,staticClass:"img-item",attrs:{href:t.file_path_full,target:"_blank",rel:"noopener noreferrer"}},[o("div",{staticClass:"img-box"},[o("img",{attrs:{src:t.file_path_full,alt:"上传图片"}})]),o("div",{staticClass:"btn-del"},[o("span",{on:{click:function(t){return t.preventDefault(),e.delImg(e.followUpForm[0].imgList.img,l)}}},[e._v("删除")])])])})),0)],2):e._e()])],1):e._e()])])],1):e._e(),"1"===e.followUpForm[0].follow_result||"2"===e.currentStage?o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm1",attrs:{model:e.followUpForm[1],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单是否完成「佣金核对」：",prop:"follow_result",rules:[{required:!0,message:"请选择当前阶段完成情况",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[1].follow_result,callback:function(t){e.$set(e.followUpForm[1],"follow_result",t)},expression:"followUpForm[1].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("是")]),o("el-radio",{attrs:{label:"2"}},[e._v("否")])],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[1].follow_result?o("el-form-item",{attrs:{label:"佣金核对完成日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[1].business_datetime,callback:function(t){e.$set(e.followUpForm[1],"business_datetime",t)},expression:"followUpForm[1].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["2"===e.followUpForm[1].follow_result?o("el-form-item",{attrs:{label:"预计佣金核对完成日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[1].business_datetime,callback:function(t){e.$set(e.followUpForm[1],"business_datetime",t)},expression:"followUpForm[1].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[1].follow_result?o("el-form-item",{attrs:{label:"佣金核对完成的凭证（上传的凭证）：",prop:"file_type",rules:[{required:!0,message:"请选择凭证类型",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[1].file_type,callback:function(t){e.$set(e.followUpForm[1],"file_type",t)},expression:"followUpForm[1].file_type"}},[o("el-radio",{attrs:{label:"1"}},[e._v("标准：对账单")]),o("el-radio",{attrs:{label:"2"}},[e._v("非标准：微信聊天记录等")])],1)],1):e._e()],1)])])],1):e._e(),"1"!==e.commissionType||!e.followUpForm[2].is_open||"3"!==e.currentStage&&"1"!==e.followUpForm[1].follow_result?e._e():o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm2",attrs:{model:e.followUpForm[2],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单「结佣材料」是否准备齐全，且提交至合作方：",prop:"follow_result",rules:[{required:!0,message:"请选择当前阶段完成情况",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[2].follow_result,callback:function(t){e.$set(e.followUpForm[2],"follow_result",t)},expression:"followUpForm[2].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("是")]),o("el-radio",{attrs:{label:"2"}},[e._v("否")])],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[2].follow_result?o("el-form-item",{attrs:{label:"「结佣材料」准备齐全日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[2].business_datetime,callback:function(t){e.$set(e.followUpForm[2],"business_datetime",t)},expression:"followUpForm[2].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["2"===e.followUpForm[2].follow_result?o("el-form-item",{attrs:{label:"「结佣材料」预计准备齐全日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[2].business_datetime,callback:function(t){e.$set(e.followUpForm[2],"business_datetime",t)},expression:"followUpForm[2].business_datetime"}})],1):e._e()],1)])])],1),"1"===e.commissionType&&e.followUpForm[3].is_open&&("4"===e.currentStage||"1"===e.followUpForm[2].follow_result||"1"===e.followUpForm[1].follow_result&&!e.followUpForm[2].is_open)?o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm3",attrs:{model:e.followUpForm[3],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单「结佣材料」：",prop:"follow_result",rules:[{required:!0,message:"请选择当前阶段完成情况",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[3].follow_result,callback:function(t){e.$set(e.followUpForm[3],"follow_result",t)},expression:"followUpForm[3].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("合作方审核通过，材料没问题")]),o("el-radio",{attrs:{label:"2"}},[e._v("合作方审核中")]),"4"===e.currentStage?o("el-radio",{attrs:{label:"3"}},[e._v("合作审核不通过，材料有问题")]):e._e()],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[3].follow_result?o("el-form-item",{attrs:{label:"合作方「结佣材料」审核通过日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[3].business_datetime,callback:function(t){e.$set(e.followUpForm[3],"business_datetime",t)},expression:"followUpForm[3].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["2"===e.followUpForm[3].follow_result?o("el-form-item",{attrs:{label:"合作方「结佣材料」预计审核通过日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[3].business_datetime,callback:function(t){e.$set(e.followUpForm[3],"business_datetime",t)},expression:"followUpForm[3].business_datetime"}})],1):e._e()],1),"4"===e.currentStage?o("div",{staticClass:"form-item-box"},["3"===e.followUpForm[3].follow_result?o("el-form-item",{attrs:{label:"原因：",prop:"follow_reason",rules:[{required:!0,message:"请填写原因",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"text"},model:{value:e.followUpForm[3].follow_reason,callback:function(t){e.$set(e.followUpForm[3],"follow_reason",t)},expression:"followUpForm[3].follow_reason"}})],1):e._e()],1):e._e()])])],1):e._e(),"1"===e.commissionType&&e.followUpForm[4].is_open&&("5"===e.currentStage||"1"===e.followUpForm[3].follow_result||"1"===e.followUpForm[2].follow_result&&!e.followUpForm[3].is_open||"1"===e.followUpForm[1].follow_result&&!e.followUpForm[2].is_open&&!e.followUpForm[3].is_open)?o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm4",attrs:{model:e.followUpForm[4],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单「发票」进度：",prop:"follow_result",rules:[{required:!0,message:"请选择当前阶段完成情况",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[4].follow_result,callback:function(t){e.$set(e.followUpForm[4],"follow_result",t)},expression:"followUpForm[4].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("已开票，对方已经收到")]),o("el-radio",{attrs:{label:"2"}},[e._v("无需开票")]),o("el-radio",{attrs:{label:"3"}},[e._v("已开票，已邮寄")]),o("el-radio",{attrs:{label:"4"}},[e._v("已开票，未邮寄")]),o("el-radio",{attrs:{label:"5"}},[e._v("开票审批已提交，待开票")]),o("el-radio",{attrs:{label:"6"}},[e._v("开票审批未提交")])],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"合作方收到「发票」日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[4].business_datetime,callback:function(t){e.$set(e.followUpForm[4],"business_datetime",t)},expression:"followUpForm[4].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"}),o("div",{staticClass:"form-item-box"},["3"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"预计收到发票日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[4].business_datetime,callback:function(t){e.$set(e.followUpForm[4],"business_datetime",t)},expression:"followUpForm[4].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["4"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"预计收到发票日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[4].business_datetime,callback:function(t){e.$set(e.followUpForm[4],"business_datetime",t)},expression:"followUpForm[4].business_datetime"}})],1):e._e(),"4"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"原因：",prop:"follow_reason",rules:[{required:!0,message:"请填写原因",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"text"},model:{value:e.followUpForm[4].follow_reason,callback:function(t){e.$set(e.followUpForm[4],"follow_reason",t)},expression:"followUpForm[4].follow_reason"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["5"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"预计开票日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[4].business_datetime,callback:function(t){e.$set(e.followUpForm[4],"business_datetime",t)},expression:"followUpForm[4].business_datetime"}})],1):e._e(),"5"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"原因：",prop:"follow_reason",rules:[{required:!0,message:"请填写原因",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"text"},model:{value:e.followUpForm[4].follow_reason,callback:function(t){e.$set(e.followUpForm[4],"follow_reason",t)},expression:"followUpForm[4].follow_reason"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["6"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"预计开票日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[4].business_datetime,callback:function(t){e.$set(e.followUpForm[4],"business_datetime",t)},expression:"followUpForm[4].business_datetime"}})],1):e._e(),"6"===e.followUpForm[4].follow_result?o("el-form-item",{attrs:{label:"原因：",prop:"follow_reason",rules:[{required:!0,message:"请填写原因",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"text"},model:{value:e.followUpForm[4].follow_reason,callback:function(t){e.$set(e.followUpForm[4],"follow_reason",t)},expression:"followUpForm[4].follow_reason"}})],1):e._e()],1)])])],1):e._e(),"1"!==e.commissionType||!e.followUpForm[5].is_open||"6"!==e.currentStage&&"1"!==e.followUpForm[4].follow_result&&"2"!==e.followUpForm[4].follow_result&&("1"!==e.followUpForm[3].follow_result||e.followUpForm[4].is_open)&&("1"!==e.followUpForm[2].follow_result||e.followUpForm[3].is_open||e.followUpForm[4].is_open)&&("1"!==e.followUpForm[1].follow_result||e.followUpForm[2].is_open||e.followUpForm[3].is_open||e.followUpForm[4].is_open)?e._e():o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm5",attrs:{model:e.followUpForm[5],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单「付款审批」：",prop:"follow_result",rules:[{required:!0,message:"请选择当前阶段完成情况",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[5].follow_result,callback:function(t){e.$set(e.followUpForm[5],"follow_result",t)},expression:"followUpForm[5].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("合作方审核通过")]),o("el-radio",{attrs:{label:"2"}},[e._v("合作方审核中")]),"6"===e.currentStage?o("el-radio",{attrs:{label:"3"}},[e._v("合作方审批不通过")]):e._e()],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[5].follow_result?o("el-form-item",{attrs:{label:"合作方「付款审批」通过日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[5].business_datetime,callback:function(t){e.$set(e.followUpForm[5],"business_datetime",t)},expression:"followUpForm[5].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["2"===e.followUpForm[5].follow_result?o("el-form-item",{attrs:{label:"合作方「付款审批」预计通过日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[5].business_datetime,callback:function(t){e.$set(e.followUpForm[5],"business_datetime",t)},expression:"followUpForm[5].business_datetime"}})],1):e._e()],1),"6"===e.currentStage?o("div",{staticClass:"form-item-box"},["3"===e.followUpForm[5].follow_result?o("el-form-item",{attrs:{label:"原因：",prop:"follow_reason",rules:[{required:!0,message:"请填写原因",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"text"},model:{value:e.followUpForm[5].follow_reason,callback:function(t){e.$set(e.followUpForm[5],"follow_reason",t)},expression:"followUpForm[5].follow_reason"}})],1):e._e()],1):e._e()])])],1),"7"!==e.currentStage&&"1"!==e.followUpForm[5].follow_result&&("1"!==e.followUpForm[4].follow_result&&"2"!==e.followUpForm[4].follow_result||e.followUpForm[5].is_open)&&("1"!==e.followUpForm[3].follow_result||e.followUpForm[4].is_open||e.followUpForm[5].is_open)&&("1"!==e.followUpForm[2].follow_result||e.followUpForm[3].is_open||e.followUpForm[4].is_open||e.followUpForm[5].is_open)&&("1"!==e.followUpForm[1].follow_result||e.followUpForm[2].is_open||e.followUpForm[3].is_open||e.followUpForm[4].is_open||e.followUpForm[5].is_open)&&("2"!==e.commissionType||"1"!==e.followUpForm[1].follow_result)?e._e():o("div",{staticClass:"step-item-box left-right-layout"},[o("el-form",{ref:"followUpForm6",attrs:{model:e.followUpForm[6],inline:!0}},[o("div",{staticClass:"step-left"},[o("el-form-item",{attrs:{label:"以上成交单「付款进度」：",prop:"follow_result",rules:[{required:!0,message:"请选择当前阶段完成情况",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpForm[6].follow_result,callback:function(t){e.$set(e.followUpForm[6],"follow_result",t)},expression:"followUpForm[6].follow_result"}},[o("el-radio",{attrs:{label:"1"}},[e._v("已完成全部付款")]),o("el-radio",{attrs:{label:"2"}},[e._v("等待付款")]),"7"===e.currentStage?o("el-radio",{attrs:{label:"3"}},[e._v("付款失败")]):e._e()],1)],1)],1),o("div",{staticClass:"step-right"},[o("div",{staticClass:"form-item-box"},["1"===e.followUpForm[6].follow_result?o("el-form-item",{attrs:{label:"实际付款日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsBefore},model:{value:e.followUpForm[6].business_datetime,callback:function(t){e.$set(e.followUpForm[6],"business_datetime",t)},expression:"followUpForm[6].business_datetime"}})],1):e._e()],1),o("div",{staticClass:"form-item-box"},["2"===e.followUpForm[6].follow_result?o("el-form-item",{attrs:{label:"预计回款日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[6].business_datetime,callback:function(t){e.$set(e.followUpForm[6],"business_datetime",t)},expression:"followUpForm[6].business_datetime"}})],1):e._e()],1),"7"===e.currentStage?o("div",{staticClass:"form-item-box"},["3"===e.followUpForm[6].follow_result?o("el-form-item",{attrs:{label:"预计回款日期：",prop:"business_datetime",rules:[{required:!0,message:"请选择日期",trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptionsAfter},model:{value:e.followUpForm[6].business_datetime,callback:function(t){e.$set(e.followUpForm[6],"business_datetime",t)},expression:"followUpForm[6].business_datetime"}})],1):e._e(),"3"===e.followUpForm[6].follow_result?o("el-form-item",{attrs:{label:"原因：",prop:"follow_reason",rules:[{required:!0,message:"请填写原因",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"text"},model:{value:e.followUpForm[6].follow_reason,callback:function(t){e.$set(e.followUpForm[6],"follow_reason",t)},expression:"followUpForm[6].follow_reason"}})],1):e._e()],1):e._e()])])],1),"2"===e.followUpForm[1].follow_result&&"2"===e.currentStage||"2"===e.followUpForm[2].follow_result&&"3"===e.currentStage||"3"===e.followUpForm[3].follow_result&&"4"===e.currentStage||e.followUpForm[4].follow_result&&"1"!==e.followUpForm[4].follow_result&&"2"!==e.followUpForm[4].follow_result&&"5"===e.currentStage||"3"===e.followUpForm[5].follow_result&&"6"===e.currentStage||"3"===e.followUpForm[6].follow_result&&"7"===e.currentStage||"8"===e.currentStage?o("div",{staticClass:"follow-back"},[o("el-form-item",{attrs:{label:"选择重置回哪个阶段：",prop:"backStage",rules:[{required:!0,message:"选择重置回哪个阶段",trigger:["blur","change"]}]}},[o("el-radio-group",{model:{value:e.followUpOtherForm.backStage,callback:function(t){e.$set(e.followUpOtherForm,"backStage",t)},expression:"followUpOtherForm.backStage"}},[o("el-radio",{attrs:{label:"0"}},[e._v("无需重置")]),e._l(e.moneyBackConfigList,(function(t,l){return["1"===e.commissionType&&l<e.currentStage-1&&"1"===t.is_open?o("el-radio",{key:t.stage_type,attrs:{label:t.stage_type}},[e._v(e._s(t.stage_type)+"-"+e._s(t.stage_name))]):e._e()]})),e._l(e.moneyBackConfigList,(function(t,l){return["2"===e.commissionType&&[1,2,7,8].includes(l+1)&&l<e.currentStage-1&&"1"===t.is_open?o("el-radio",{key:t.stage_type,attrs:{label:t.stage_type}},[e._v(e._s(t.stage_type)+"-"+e._s(t.stage_name))]):e._e()]}))],2)],1)],1):e._e(),o("div",{staticClass:"step-item-box"},[o("el-form-item",{attrs:{label:"本次跟进凭证：",required:""}},[e.limit?o("jl-file-upload",{ref:"fileUpload",staticClass:"upload-btn",attrs:{fileType:"doc,docx,jpg,png,jpeg,gif,xlsx,xls,pdf",fileMaxSize:"10mb",upID:"followUpUpload",ossData:e.ossData},on:{beforeUpdate:e.beforeUpdate,getFileURL:e.getFileURL}},[o("el-button",{attrs:{type:"primary"}},[e._v("上传凭证")])],1):e._e(),o("span",{staticClass:"upload-tips"},[e._v("可上传图片、excel、word、pdf，上传不超过10个文件，每个附件不超过10M")]),o("div",{staticClass:"file-show-box"},[e.voucher.fileArr.length>0?o("ul",{staticClass:"file-list"},e._l(e.voucher.fileArr,(function(t,l){return o("li",{key:l},[o("a",{staticClass:"preview-file",attrs:{href:e.OSSView+t.fileURL,target:"_blank",rel:"noopener noreferrer"}},[o("span",[e._v(e._s(t.file_name))])]),o("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delFile("file",l)}}},[e._v("删除")])],1)})),0):e._e(),e.voucher.imgArr.length>0?o("ul",{staticClass:"img-list clearfix"},e._l(e.voucher.imgArr,(function(t,l){return o("li",{key:l},[o("div",{staticClass:"img-item-box"},[o("img",{attrs:{src:t.fileURL,alt:"图片凭证"},on:{click:function(o){return e.showPreview(t.fileURL)}}})]),o("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delFile("img",l)}}},[e._v("删除")])],1)})),0):e._e()])],1)],1),o("div",{staticClass:"step-item-box"},[o("el-form-item",{staticClass:"input-text-box",attrs:{label:"跟进说明：",prop:"explain",rules:[{required:!0,message:"请填写跟进说明",trigger:["blur","change"]}]}},[o("el-input",{attrs:{type:"textarea",rows:3,maxlength:"500",resize:"none",placeholder:"请认真填写本次跟进说明"},model:{value:e.followUpOtherForm.explain,callback:function(t){e.$set(e.followUpOtherForm,"explain",t)},expression:"followUpOtherForm.explain"}})],1)],1),o("div",{staticClass:"step-item-box"},[o("el-form-item",{attrs:{label:"下次跟进时间：",prop:"nextFollowTime",rules:[{required:!0,validator:e.checkNextFollowTime,trigger:["blur","change"]}]}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm:ss","value-format":"timestamp","picker-options":e.pickerOptionsLimit},model:{value:e.followUpOtherForm.nextFollowTime,callback:function(t){e.$set(e.followUpOtherForm,"nextFollowTime",t)},expression:"followUpOtherForm.nextFollowTime"}})],1)],1),o("div",{staticClass:"step-item-box"},[o("el-form-item",{attrs:{label:"下次跟进人：",prop:"nextFollowEmployee",rules:[{required:!0,message:"请选择下次跟进人",trigger:["blur","change"]}]}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.followUpOtherForm.nextFollowEmployee,callback:function(t){e.$set(e.followUpOtherForm,"nextFollowEmployee",t)},expression:"followUpOtherForm.nextFollowEmployee"}},e._l(e.followEmployeeSelect,(function(e){return o("el-option",{key:e.id,attrs:{label:e.text,value:e.id}})})),1)],1)],1),"8"!==e.currentStage?o("div",{staticClass:"step-item-box tips"},[o("p",[e._v("跟进规则：")]),"1"===e.currentStage?o("p",[e._v("1、以上成交单需在"+e._s(e.completeDatetime)+"前完成业绩确认，否则将被标记延迟")]):e._e(),o("p",[e._v(e._s("1"===e.currentStage?"2、":"")+"在「1-核对业绩」-「7-等待付款」阶段，需要每周发生一次有效跟进（录入系统后主管审核通过）")])]):e._e()]),o("div",{staticClass:"btn-area"},[o("el-button",{on:{click:e.toFundsFollow}},[e._v("取消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("保存")])],1)],1):e._e()],1)])])],1)],1),e.photoIsShow?o("jl-image-preview",{attrs:{showViewer:e.photoIsShow,urlList:e.previewUrl},on:{closeViewer:e.closeViewer}}):e._e(),o("el-dialog",{staticClass:"common-dialog",attrs:{title:"提示",visible:e.confirmTipDialog,width:"350px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,center:""},on:{"update:visible":function(t){e.confirmTipDialog=t}}},[o("div",[e._v("在成功回款之前回款负责人自行保管好对账单纸质原件，谨防丢失！对账单是超账期未回款订单走诉讼流程的有力凭证")]),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("知道了")])],1)])],1)},r=[]},"405c":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=o("23f7"),r={getFundsBackList:function(e){return l.axios.post("/backend-api/expand/ex-money-back-config/list",e)},addFundsBack:function(e){return l.axios.post("/backend-api/expand/ex-money-back-config/add-config",e)},editFundsBack:function(e){return l.axios.post("/backend-api/expand/ex-money-back-config/edit-config",e)},initEditFundsBack:function(e){return l.axios.post("/backend-api/expand/ex-money-back-config/edit-init",e)},getFundsBackInfo:function(e){return l.axios.post("/backend-api/expand/ex-money-back-config/view-init",e)},delFundsBack:function(e){return l.axios.post("/backend-api/expand/ex-money-back-config/del-config",e)},stayFollowInit:function(e){return l.axios.get("/backend-api/expand/ex-money-back-group/init",{params:e})},stayFollowTb:function(e){return l.axios.get("/backend-api/expand/ex-money-back-group/to-be-assoc-list",{params:e})},markConfrim:function(e){return l.axios.get("/backend-api/expand/ex-money-back-group/add-group",{params:e})},initFollow:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/init-follow",e)},followedForecastList:function(e){return l.axios.get("/backend-api/expand/ex-money-back-group/followed-forecast-list",{params:e})},getForecastList:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/get-forecast",e)},addFollow:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/add-follow",e,{headers:{"Content-Type":"application/json"}})},followTb:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/list",e)},mergeFollow:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/merge",e)},followDetail:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/follow-detail",e)},followAudit:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/follow-audit",e)},getGroupDetail:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/group-detail",e)},getDealDetail:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/deal-detail",e)},delGroup:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/cancel",e)},resumeGroup:function(e){return l.axios.post("/backend-api/expand/ex-money-back-group/recovery",e)}};t.default=r},"41b8":function(e,t,o){"use strict";o("1d6c")},"45fc":function(e,t,o){"use strict";var l=o("23e7"),r=o("b727").some,a=o("a640"),i=o("ae40"),s=a("some"),n=i("some");l({target:"Array",proto:!0,forced:!s||!n},{some:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},"5fb2":function(e,t,o){"use strict";o.r(t);var l=o("3eff"),r=o("c17c");for(var a in r)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return r[e]}))}(a);o("904c");var i=o("2877"),s=Object(i.a)(r.default,l.a,l.b,!1,null,"26973d6c",null);t.default=s.exports},8379:function(e,t,o){(t=o("24fb")(!1)).push([e.i,".turn-to-page[data-v-349e4c72]{display:inline-block;color:#46aaff;cursor:pointer}",""]),e.exports=t},8533:function(e,t,o){"use strict";var l=o("4ea4");o("99af"),o("a623"),o("4160"),o("c975"),o("baa5"),o("45fc"),o("a434"),o("d3b7"),o("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o("5530")),a=l(o("2909"));o("96cf");var i=l(o("1da1")),s=o("f946"),n=l(o("405c")),f=l(o("f032")),p=l(o("a5a1")),m=o("2f62"),u={name:"edit-follow-up",components:{FollowUpList:f.default},data:function(){return{confirmTipDialog:!1,imgLimit:10,loading:"",groupId:this.$route.query.groupId,currentStage:"",currentStageName:"",targetStageType:"0",followTimeForm:{actualTime:Date.parse(new Date),estimateTime:""},followUpOtherForm:{backStage:"",nextFollowTime:"",nextFollowEmployee:"",explain:""},voucher:{fileArr:[],imgArr:[]},followUpForm:[],uploadUrl:"followUp",ossData:{},photoIsShow:!1,previewUrl:[],limit:10,completeDatetime:"",followEmployeeSelect:[],moneyBackConfigList:[],userInfoObj:{},nextFollowDatetimeMax:"",commissionType:"",isSubmit:!0,pickerOptionsBefore:{disabledDate:function(e){return e.getTime()>Date.now()}},pickerOptionsAfter:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},pickerOptionsLimit:{disabledDate:""}}},created:function(){var e=this;this.commissionType=-1===this.$route.query.commissionType.indexOf("1")?"1":"2",this.$nextTick((function(){e.initData()}))},methods:{checkImg:function(e,t,o){t.img&&t.img.length>0||t.file&&t.file.length>0?o():o(new Error("请上传业绩确认单"))},delImg:function(e,t){e.splice(t,1),this.imgLimit++,this.$refs.followUpForm0.validateField("imgList")},getFileURLMethod:function(e,t){var o=this;if(this.loading.close(),0!==e.length){for(var l=!1,r=function(r){var a="pdf"===e[r].extension.toLowerCase();if(a?t.file.some((function(t){return t.file_name===e[r].originName})):t.img.some((function(t){return t.file_name===e[r].originName})))l=!0;else{var i={file_name:e[r].originName,file_url:e[r].upURL,file_path_full:e[r].fileURL,file_type:"1"};a?(i.file_type="2",t.file.push(i)):t.img.push(i),o.imgLimit--}},a=0;a<e.length;a++)r(a);l&&this.$message("无法上传重复的业绩确认单"),this.$refs.followUpForm0.validateField("imgList")}else this.$message("上传失败,请重新上传")},disabledDate:function(e){return e.getTime()>this.nextFollowDatetimeMax||e.getTime()<Date.now()-864e5},checkNextFollowTime:function(e,t,o){if(!t)return o(new Error("请选择下次跟进时间"));var l=p.default.filterDate(this.nextFollowDatetimeMax,"YYYY-MM-DD HH:mm:ss");return t>this.nextFollowDatetimeMax?(this.followUpOtherForm.nextFollowTime=this.nextFollowDatetimeMax,this.$message("截止时间为".concat(l)),o(new Error("可选择现在-".concat(l,"的时间")))):t<Date.parse(new Date)?(this.followUpOtherForm.nextFollowTime=Date.parse(new Date),this.$message("不能选择之前的时间"),o(new Error("不能选择之前的时间"))):void o()},showPreview:function(e){this.photoIsShow=!0,this.previewUrl=[e]},closeViewer:function(){this.photoIsShow=!1,this.previewUrl=[]},initData:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var o,l,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.beforeUpdate(),o={group_id:e.groupId},t.prev=2,t.next=5,n.default.initFollow(o);case 5:l=t.sent,0===(r=l.data).code&&(e.currentStage=r.data.stage_type,e.currentStageName=r.data.stage_type_name,e.completeDatetime=r.data.complete_datetime,e.followEmployeeSelect=r.data.follow_employee_select,e.moneyBackConfigList=r.data.money_back_config,e.nextFollowDatetimeMax=1e3*r.data.next_follow_datetime_max,e.followUpOtherForm.nextFollowTime=r.data.next_follow_datetime_def?1e3*r.data.next_follow_datetime_def:"","2"===e.currentStage&&(e.followUpOtherForm.backStage="0"),a=[],r.data.money_back_config.forEach((function(t,o){var l={is_open:"1"===t.is_open?1:0,follow_stage_type:t.stage_type,follow_result:o<3?"2":"",file_type:"",business_datetime:"",follow_reason:""};"1"===e.currentStage&&(l.imgList={img:[],file:[]}),a.push(l)})),e.followUpForm=a,e.pickerOptionsLimit.disabledDate=e.disabledDate,e.loading.close(),e.getSignCode()),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),console.log(t.t0),e.loading.close();case 14:case"end":return t.stop()}}),t,null,[[2,10]])})))()},getSignCode:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var o,l,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={cate:e.uploadUrl},t.prev=1,t.next=4,(0,s.getSign)(o);case 4:l=t.sent,0===(r=l.data).code&&(e.ossData=r.data),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),console.log(t.t0);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})))()},beforeUpdate:function(){this.loading=this.$loading({lock:!0,text:"请求中，请稍后",spinner:"el-icon-loading",customClass:"loading-default-box",background:"rgba(255, 255, 255, 0.8)"})},getFileURL:function(e){if(this.loading.close(),0!==e.length){var t={file_name:e[0].originName,file_url:e[0].upURL,fileURL:e[0].fileURL};-1!=="jpg,png,jpeg,gif,GIF,JPG,PNG,JPEG".indexOf(e[0].originName.substr(e[0].originName.lastIndexOf(".")+1))?(t.file_type="1",this.voucher.imgArr.some((function(t){return t.file_name===e[0].originName}))?this.$message("无法上传重复的凭证"):(t.file_type="1",this.voucher.imgArr.push(t),this.limit--)):this.voucher.fileArr.some((function(t){return t.file_name===e[0].originName}))?this.$message("无法上传重复的凭证"):(t.file_type="2",this.voucher.fileArr.push(t),this.limit--)}else this.$message("上传失败,请重新上传")},delFile:function(e,t){this.limit++,"file"==e?this.voucher.fileArr.splice(t,1):this.voucher.imgArr.splice(t,1)},beforeSubmitSevenFollow:function(){var e=this;return new Promise((function(t){var o=[];e.followUpForm.forEach(function(){var l=(0,i.default)(regeneratorRuntime.mark((function l(r,a){var i,s,n;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(!e.$refs["followUpForm".concat(a)]){l.next=18;break}return l.prev=1,l.next=4,e.$refs["followUpForm".concat(a)].validate();case 4:if(o.push(1),7!==o.length){l.next=8;break}return i=o.every((function(e){return 1===e})),l.abrupt("return",t(i));case 8:l.next=16;break;case 10:if(l.prev=10,l.t0=l.catch(1),o.push(0),7!==o.length){l.next=16;break}return s=o.every((function(e){return 1===e})),l.abrupt("return",t(s));case 16:l.next=22;break;case 18:if(o.push(1),7!==o.length){l.next=22;break}return n=o.every((function(e){return 1===e})),l.abrupt("return",t(n));case 22:case"end":return l.stop()}}),l,null,[[1,10]])})));return function(e,t){return l.apply(this,arguments)}}())}))},beforeSubmitOtherFollow:function(){var e=this;return new Promise(function(){var t=(0,i.default)(regeneratorRuntime.mark((function t(o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.followTimeForm.validate();case 3:return t.next=5,e.$refs.followUpOtherForm.validate();case 5:return t.abrupt("return",o(!0));case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",o(t.t0));case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}())},submitForm:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var o,l,r,i,s,f,p,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.beforeSubmitSevenFollow();case 2:return o=t.sent,t.next=5,e.beforeSubmitOtherFollow();case 5:if(l=t.sent,o&&l){t.next=11;break}return e.$message("必填字段未填写，无法提交"),t.abrupt("return");case 11:if(e.voucher.fileArr.length+e.voucher.imgArr.length!==0){t.next=16;break}return e.$message("请上传跟进凭证"),t.abrupt("return");case 16:if(e.$refs.followUpList.getFollowMoneyTotalFlag()){t.next=19;break}return e.$message("本次跟进金额合计不能大于单笔剩余回款金额合计，请修改后提交"),t.abrupt("return");case 19:if(!(r=e.$refs.followUpList.getMoneyDetailList()).list||!Array.isArray(r.list)){t.next=25;break}if(!r.list.some((function(e){return e.follow_money<=0}))){t.next=25;break}return e.$message("跟进金额必须＞0"),t.abrupt("return");case 25:if(e.targetStageType>=e.currentStage&&(e.followUpOtherForm.backStage="0"),!e.isSubmit){t.next=51;break}return e.isSubmit=!1,e.beforeUpdate(),(i={group_id:e.groupId,follow_datetime:e.followTimeForm.actualTime,plan_pay_datetime:e.followTimeForm.estimateTime,employee_id:e.userInfoObj.id,follow_text:e.followUpOtherForm.explain,next_follow_datetime:e.followUpOtherForm.nextFollowTime,next_employee_id:e.followUpOtherForm.nextFollowEmployee,start_stage_type:e.currentStage,back_stage_type:e.followUpOtherForm.backStage,target_stage_type:e.targetStageType,money:e.$refs.followUpList.getMoneyList(),detail_list:r,move:e.$refs.followUpList.getRemoveList(),is_front:-1===e.$route.query.commissionType.indexOf("1")?"2":"1"}).file=e.voucher.imgArr.concat(e.voucher.fileArr),s=[],e.followUpForm[0].imgList&&(s=[].concat((0,a.default)(e.followUpForm[0].imgList.img),(0,a.default)(e.followUpForm[0].imgList.file))),i.confirm_file=s,f=[],e.followUpForm.forEach((function(t,o){t.is_open&&e.$refs["followUpForm".concat(o)]&&f.push(t)})),"8"===e.currentStage&&(f=[{follow_stage_type:"8",follow_result:"",file_type:"",business_datetime:"",follow_reason:""}]),i.stage_type_list=f,t.prev=38,t.next=41,n.default.addFollow(i);case 41:p=t.sent,0===(m=p.data).code?("1"===e.currentStage&&"1"===e.followUpForm[0].follow_result?e.confirmTipDialog=!0:e.toFundsFollow(),e.isSubmit=!0,e.loading.close()):(e.$message(m.msg),e.isSubmit=!0,e.loading.close()),t.next=51;break;case 46:t.prev=46,t.t0=t.catch(38),console.log(t.t0),e.isSubmit=!0,e.loading.close();case 51:case"end":return t.stop()}}),t,null,[[38,46]])})))()},confirm:function(){this.confirmTipDialog=!1,this.toFundsFollow()},toFundsFollow:function(){this.$router.push({path:"/fundsBack/fundsFollow",query:{tab:"list"}})},matchType:function(e){for(var t=null,o=e;o>0;o--)if(1===this.followUpForm[o].is_open&&"1"===this.followUpForm[o].follow_result){t=this.followUpForm[o].follow_stage_type;break}return t}},computed:(0,r.default)((0,r.default)({},(0,m.mapState)({userInfo:function(e){return e.userInfo}})),{},{tempFollowUpForm:function(){var e=[];return this.followUpForm.forEach((function(t){e.push(JSON.parse(JSON.stringify(t)))})),e},imgListLenFlag:function(){var e=this.followUpForm[0].imgList;return!!e&&!!(e.file&&e.file.length||e.img&&e.img.length)}}),watch:{tempFollowUpForm:{handler:function(e,t){var o=this,l=-1;e.forEach((function(r,a){if(r.follow_result&&t[a]&&r.follow_result!==t[a].follow_result&&(1===a&&("1"===e[0].follow_result||"2"===o.currentStage)||2===a&&("1"===e[1].follow_result||"3"===o.currentStage)||1!==a&&2!==a))if(l=a,"1"===r.follow_result||4===a&&"2"===r.follow_result)o.targetStageType=r.follow_stage_type;else if(String(a+1)!==o.currentStage||"1"===r.follow_result||4===a&&"2"===r.follow_result){var i=o.matchType(a);null!==i&&(o.targetStageType=i)}else o.targetStageType="0";if(l>=0){var s={is_open:r.is_open,follow_stage_type:r.follow_stage_type,follow_result:a<3?"2":"",file_type:"",business_datetime:"",follow_reason:""};"1"===o.currentStage&&(s.imgList={img:[],file:[]},o.imgLimit=10),l===a&&(s.follow_result=r.follow_result),o.$set(o.followUpForm,a,s)}}))},deep:!0,immediate:!0},userInfo:{deep:!0,handler:function(e){this.userInfoObj={id:e.uid,text:e.employeeName+"_"+e.job_number},this.followUpOtherForm.nextFollowEmployee=String(e.uid)}}}};t.default=u},"8d71":function(e,t,o){var l=o("1500");"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);(0,o("499e").default)("ae807058",l,!0,{sourceMap:!1,shadowMode:!1})},"904c":function(e,t,o){"use strict";o("8d71")},a15b:function(e,t,o){"use strict";var l=o("23e7"),r=o("44ad"),a=o("fc6a"),i=o("a640"),s=[].join,n=r!=Object,f=i("join",",");l({target:"Array",proto:!0,forced:n||!f},{join:function(e){return s.call(a(this),void 0===e?",":e)}})},a5a1:function(e,t,o){"use strict";var l=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=l(o("c1df")),a={filterDate:function(e,t){if(e){var o=parseInt(e);return(0,r.default)(o).format(t)}}};t.default=a},a623:function(e,t,o){"use strict";var l=o("23e7"),r=o("b727").every,a=o("a640"),i=o("ae40"),s=a("every"),n=i("every");l({target:"Array",proto:!0,forced:!s||!n},{every:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},be8b:function(e,t,o){"use strict";o.d(t,"a",(function(){return l})),o.d(t,"b",(function(){return r}));var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"follow-up-list-wrapper"},[o("div",{staticClass:"table-wrap-new"},[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tableFixedWrap",attrs:{border:"",data:e.tableList,size:"small","show-summary":"","summary-method":e.getSummaries,"row-class-name":"row","cell-class-name":"column","highlight-current-row":!0,"header-cell-style":e.tableHeaderColor}},[o("el-table-column",{attrs:{"min-width":"80",prop:"city_name",label:"地理城市",fixed:"",align:"center"}}),o("el-table-column",{attrs:{"min-width":"100",prop:"deal_id",label:"成交ID",fixed:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"turn-to-page",on:{click:function(o){return e.turnToNewPage(t.row.deal_url)}}},[e._v(e._s(t.row.deal_id))])]}}])}),o("el-table-column",{attrs:{"min-width":"180",prop:"project_name",label:"楼盘名称",fixed:"",align:"center"}}),o("el-table-column",{attrs:{"min-width":"100",prop:"username",label:"成交客户姓名",fixed:"",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"deal_step",label:"成交单进度",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"subscribe_datetime",label:"认购日期",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"grass_datetime",label:"草签日期",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"sign_datetime",label:"网签日期",align:"center"}}),o("el-table-column",{attrs:{"min-width":"100",prop:"cooperate_type",label:"合作方式",align:"center"}}),o("el-table-column",{attrs:{"min-width":"100",prop:"commission_type",label:"回款类型",align:"center"}}),o("el-table-column",{attrs:{"min-width":"300",prop:"forecast_content",label:"单笔合同预测子条件",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"pre_paid_money",label:"单笔合同预测金额",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"unfollowed_money",label:"单笔剩余回款金额",align:"center"}}),o("el-table-column",{attrs:{"min-width":"120",prop:"follow_money",label:"本次跟进金额",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"!==e.pageType||"1"!==e.currentStage&&"2"!==e.currentStage?o("span",[e._v(e._s(t.row.follow_money))]):o("jl-number-input",{attrs:{reg:"twoNum"},nativeOn:{input:function(o){return e.followUpFun(t.$index,t.row)}},model:{value:e.tableList[t.$index].follow_money,callback:function(o){e.$set(e.tableList[t.$index],"follow_money",o)},expression:"tableList[scope.$index].follow_money"}})]}}])}),"1"===e.pageType?o("el-table-column",{attrs:{fixed:"right","min-width":"80",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",size:"medium",disabled:e.tableList.length<=1},on:{click:function(o){return e.moveOut(t.$index,t.row.id)}}},[e._v("移除")])]}}],null,!1,1554424278)}):e._e()],1)],1)])},r=[]},c17c:function(e,t,o){"use strict";o.r(t);var l=o("8533"),r=o.n(l);for(var a in l)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return l[e]}))}(a);t.default=r.a},f032:function(e,t,o){"use strict";o.r(t);var l=o("be8b"),r=o("0db9");for(var a in r)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return r[e]}))}(a);o("41b8");var i=o("2877"),s=Object(i.a)(r.default,l.a,l.b,!1,null,"349e4c72",null);t.default=s.exports}}]);